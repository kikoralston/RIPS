\documentclass[11pt, oneside]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 

\usepackage{macro}

\usepackage{float}
\usepackage{booktabs}

\newcommand{\flow}{\text{flow}}
\newcommand{\bc}{\bar{c}}

\title{Capacity Expansion Model}
\author{Francisco Fonseca}

\begin{document}
\maketitle

\tableofcontents

\newpage

\section{Overview}

This document presents the formulation of the Capacity Expansion (CE) optimization model. I tried the definitions of variables and equations as close as possible to the way they are defined in the \texttt{.gams} file. This way it should be easier to debug the optimization problem. For example, instead of defining a single variable $n_{(\cdot)}$ for the number of new generators in each pair (location, type), I used the same definitions as the \texttt{.gams} file and created three variables: $n^{(c)}_{c, j}$, $n^{(\bc)}_{z, j}$ and $n^{(r)}_{z, j}$ (which refer, respectively, to thermal generators that can be curtailed, thermal generators that cannot be curtailed and renewable generators).

\section{Definitions}

\begin{table}[H]
   \centering
   \caption{Decision Variables}
   \begin{tabular}{p{1in} p{4in} } % Column formatting, @{} suppresses leading/trailing space
      \toprule
      \textbf{Set} & \textbf{Definition} \\
      \midrule
      $n^{(c)}_{c, j}$ & number of new thermal generators of type $j$ in the class that CAN be curtailed (the $(c)$ superscript) built in CELL $c$\\
      $n^{(\bc)}_{z, j}$ & number of new thermal generators of type $j$ in the class that CANNOT be curtailed (the $(\bc)$ superscript) built in ZONE $z$\\
      $n^{(r)}_{z, j}$ & number of new generators of type $j$ in the class RENEWABLE (the $(r)$ superscript) built in ZONE $z$\\
      $p^{(c)}_{c, j, t}$ & electricity generation (GWh) at time $t$ of new generators  of type $j$ in the  class that CAN be curtailed (the $(c)$ superscript) built in CELL $c$\\
      $p^{(\bc)}_{z, j, t}$ & electricity generation (GWh) at time $t$ of new generators of type $j$ in the class that CANNOT be curtailed (the $(\bc)$ superscript) built in ZONE $z$\\
      $p^{(r)}_{z, j, t}$ & electricity generation (GWh) at time $t$ of new generators  of type $j$ in the class RENEWABLE (the $(r)$ superscript) built in ZONE $z$\\
      $p^{(e)}_{i, t}$ & electricity generation (GWh) at time $t$ of existing (the $(e)$ superscript) generator of index $i$ \\
      $\flow_{\ell, t}$ & flow on line $\ell$ (GW) in hour $t$\\
%
      \bottomrule
   \end{tabular}
   \label{tab:decision}
\end{table}

% Requires the booktabs if the memoir class is not being used
\begin{table}[H]
   \centering
   \caption{Sets}
   \begin{tabular}{p{1in} p{4in} } % Column formatting, @{} suppresses leading/trailing space
      \toprule
      \textbf{Set} & \textbf{Definition} \\
      \midrule
      $\Bc$ & set of user-defined time blocks. These are needed for computational purposes. $\Bc = \{\text{peak-hours, winter, summer, spring, fall, special periods}\}$ \\
      $\Ic$ & set of existing generators in the fleet. \\
      $\Ic (z)$ & subset of existing generators that are located in zone $z$.  $\Ic (z) \subseteq \Ic$\\
      $\Cc$ & set of grid cells that new techs can be placed in. \\
      $\Cc (z)$ & subset of grid cells that new techs can be placed in that are located in zone $z$. $\Cc (z) \subseteq \Cc$\\
      $\Jc$ & set of candidate plant types for new construction \\
      $\Jc^{(c)}$ & subset of plant types for new construction that can be curtailed. $\Jc^{(c)} \subseteq \Jc$\\
      $\Jc^{(\bc)}$ & subset of plant types for new construction that CANNOT be curtailed. $\Jc^{(\bc)} \subseteq \Jc$\\
      $\Jc^{(r)}$ & subset of plant types for new construction that are renewable. $\Jc^{(r)} \subseteq \Jc$\\
      $\Lc$ & set with transmission lines between load zones \\
      $\Zc$ & set with user defined load zones \\
      \bottomrule
   \end{tabular}
   \label{tab:sets}
\end{table}


% Requires the booktabs if the memoir class is not being used
\begin{table}[H]
   \centering
   \caption{Parameters}
   \begin{tabular}{p{1in} p{4in} } % Column formatting, @{} suppresses leading/trailing space
      \toprule
      \textbf{Parameter} & \textbf{Definition} \\
      \midrule
      $P^{MAX}_{c, j, t}$ & Maximum electricity generation capacity, accounting for deratings, of plant type $j \in \Jc^{(c)}$ at cell grid $c$ at time $t$ (MWh) \\
      $P^{NP}_{j}$ & Nameplate electricity generation capacity of plant type $j \in \Jc$ (MWh)\\
      $P^{MAX}_{i, t}$ & Maximum electricity generation capacity, accounting for deratings, of existing generator $i$ (non solar and non wind) at time $t$ (MWh)\\
      $P^{MAX}_{solar, t}$ & Maximum electricity generation by all existing solar generators at time $t$ (MWh) \\
      $P^{MAX}_{wind, t}$ & Maximum electricity generation by all existing wind generators at time $t$ (MWh) \\
      $\overline{\flow}_{\ell}$ &  Upper bound of transmission line $\ell$ (GW)\\
      $FOM_{j}$ & Annual fixed operation and maintenance costs of plant type $j$ (\$/MW)\\
      $OCC_{j}$ & Overnight capital cost of plant type $j$ (\$/MW) \\
      $OC_{j}$ & Operating cost of plant type $j$\ (\$/MWh) \\      
      $OC_{i}$ & Operating cost of existing plant $i$\ (\$/MWh) \\
      $M$ & Planning reserve margin as fraction (\%) of demand \\
      $Q$ & Discount rate \\
      $D_j$ & lifetime (years) of candidate plant of type $j$ \\
%      
      \bottomrule
   \end{tabular}
   \label{tab:indices}
\end{table}


% Requires the booktabs if the memoir class is not being used
\begin{table}[H]
   \centering
   \caption{Indices}
   \begin{tabular}{p{1in} p{4in} } % Column formatting, @{} suppresses leading/trailing space
      \toprule
      \textbf{Indices} & \textbf{Definition} \\
      \midrule
      $b$ & Time blocks representing peak-hours, winter, summer, spring, fall, special periods. $b \in \Bc$\\
      $c$ & grid cells that new techs can be placed in. $c \in \Cc$ \\
      $\ell$ & Transmission Lines. $\ell \in \Lc$\\
      $i$ & existing generators in fleet. $i \in \Ic$\\
      $z$ & sub regions of SERC. $z \in \Zc$\\
      \bottomrule
   \end{tabular}
   \label{tab:indices}
\end{table}

\section{Objective Function}

\begin{equation} \label{eq:obj_fun}
\begin{split}
TC = &  \sum_{c \in \Cc}\sum_{j \in \Jc^{(c)}} n^{(c)}_{c, j} \times P^{NP}_{j} \times (FOM_{j} + OCC_{j} \times CRF_{j}) \\
& +  \sum_{z \in \Zc}\sum_{j \in \Jc^{(\bc)}} n^{(\bc)}_{z, j} \times P^{NP}_{j} \times (FOM_{j} + OCC_{j} \times CRF_{j}) \\
& +  \sum_{z \in \Zc}\sum_{j \in \Jc^{(r)}} n^{(r)}_{z, j} \times P^{NP}_{j} \times (FOM_{j} + OCC_{j} \times CRF_{j}) \\
& + \sum_b \bigg( W_b \sum_{t_b \in T_b}\bigg( \sum_{c \in \Cc}\sum_{j \in \Jc^{(c)}} p^{(c)}_{c, j, t_b} \times OC_{j, t_b} + \sum_{z \in \Zc}\sum_{j \in \Jc^{(\bc)}} p^{(\bc)}_{z, j, t} \times OC_{j, t_b} \\
& \qquad\qquad\qquad\qquad +  \sum_{z \in \Zc}\sum_{j \in \Jc^{(r)}} p^{(r)}_{z, j, t_b} \times OC_{j, t_b} + \sum_{i} p_{i, t_b} \times OC_{i, t_b} \bigg)\bigg)
\end{split}
\end{equation}

$CRF_j$ is the capital recovery ratio of each technology $j$ and is defined as:

\begin{equation} \label{eq:cap_rec}
\begin{aligned}
CRF_j = \frac{Q}{1-\left(1/(1+Q)^{D_j}\right)}
\end{aligned}
\end{equation}

The variable operating cost $OC$ (in \$/MWh) for new and existing generators is equal:

\begin{align} \label{eq:oc}
OC_{j} = VOM_{j} + HR_{j} \times FC_{j}  &&  \forall~j \in \Jc && \text{(new generators)}\\
OC_{i} = VOM_{i} + HR_{i} \times FC_{i}  && \forall~i \in \Ic && \text{(existing generators)}
\end{align}

NOTE: I followed the same convention as the GAMS code, where the operating cost $OC$ does not change by time $t$ or location $c$.

\section{Supply vs Demand constraint}

\begin{equation} \label{eq:supply_demand}
\begin{split}
P^D_{t, z} = & \sum_{i \in \Ic(z)} p_{i, t} +  \sum_{c \in \Cc (z)}  \sum_{j \in \Jc^{(c)}} p^{(c)}_{c, j, t_b} + \sum_{j \in \Jc^{(\bc)}} p^{(\bc)}_{z, j, t_b} +  \sum_{j \in \Jc^{(r)}} p^{(r)}_{z, j, t_b} \\
& +  \sum_{\ell: \text{end}(\ell) = z} \flow_{\ell, t} - \sum_{\ell: \text{begin}(\ell) = z} \flow_{\ell, t}
\end{split}
\end{equation}

\section{Reserve margin constraint}

\begin{equation} \label{eq:reserve}
\begin{split}
(1+M)\times P^D_{t, z} \le & \sum_{c \in \Cc} \sum_{j \in \Jc^{(c)}} P^{MAX}_{c, j, t} \times n^{(c)}_{c, j} +   \sum_{j \in \Jc^{(r)}} P^{MAX}_{z, j, t} \times n^{(r)}_{z, j}\times CF_{j, t} \\
& + \sum_{i \in \Ic \setminus \{\Ic_w \cup \Ic_s \}} P^{MAX}_{i, t} + P^{MAX}_{\text{solar}, t} + P^{MAX}_{\text{wind}, t}
\end{split}
\end{equation}

\section{Maximum generation constraints}

\begin{equation} \label{eq:ex_solar}
\begin{split}
\sum_{i \in \Ic_s} p_{i, t} \le P^{MAX}_{\text{solar}, t} \quad \forall~t
\end{split}
\end{equation}

\begin{equation} \label{eq:ex_wind}
\begin{split}
\sum_{i \in \Ic_w} p_{i, t} \le P^{MAX}_{\text{wind}, t} \quad \forall~t
\end{split}
\end{equation}

\begin{equation} \label{eq:ex_therm}
\begin{split}
p_{i, t} \le P^{MAX}_{i, t} \quad \forall~t, \forall~i \in \Ic \setminus \{\Ic_w \cup \Ic_s \}
\end{split}
\end{equation}

\begin{equation} \label{eq:new_therm}
\begin{split}
p^{(c)}_{c, j, t} \le P^{MAX}_{c, j, t} \times n^{(c)}_{c, j} \quad \forall~c, t  \text{ and }\forall~j\in \Jc^{(c)}
\end{split}
\end{equation}

\begin{equation} \label{eq:new_therm2}
\begin{split}
p^{(\bc)}_{z, j, t} \le P^{MAX}_{z, j, t} \times n^{(\bc)}_{z, j} \quad \forall~z, t  \text{ and }\forall~j\in \Jc^{(\bc)}
\end{split}
\end{equation}

\begin{equation} \label{eq:new_ren}
\begin{split}
p^{(r)}_{z, j, t} \le n^{(r)}_{z, j}\times P^{NP}_{j} \times CF_{j, t}  \quad \forall~z, t  \text{ and }\forall~j\in \Jc^{(r)}
\end{split}
\end{equation}

\section{Transmission Constraint}

\begin{equation} \label{eq:trans}
\begin{split}
0 \le \flow_{\ell, t} \le   \overline{\flow}_{\ell} \quad \forall~\ell, t
\end{split}
\end{equation}

\end{document}  